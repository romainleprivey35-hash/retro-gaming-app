<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Retro App - Romain</title>
    <style>
        :root { --neon: #00ff88; --bg: #121212; --card: #1e1e1e; }
        body { background: var(--bg); color: white; font-family: 'Segoe UI', sans-serif; margin: 0; padding-bottom: 70px; }
        
        /* Navigation Basse */
        .bottom-nav { 
            position: fixed; bottom: 0; width: 100%; height: 60px; 
            background: #1a1a1a; display: flex; justify-content: space-around; 
            align-items: center; border-top: 1px solid #333; z-index: 1000;
        }
        .nav-item { text-align: center; font-size: 0.8rem; color: #888; text-decoration: none; cursor: pointer; }
        .nav-item.active { color: var(--neon); }

        /* Menus de s√©lection */
        .menu-grid { display: grid; grid-template-columns: 1fr; gap: 15px; padding: 20px; }
        .menu-btn { 
            background: var(--card); border: 1px solid #333; padding: 25px; 
            border-radius: 15px; text-align: center; font-size: 1.2rem; font-weight: bold;
            transition: 0.3s;
        }
        .menu-btn:active { transform: scale(0.95); border-color: var(--neon); }

        /* Stats */
        .stats-container { padding: 20px; }
        .stat-card { background: var(--card); padding: 15px; border-radius: 12px; margin-bottom: 15px; border-left: 4px solid var(--neon); }
        .stat-val { font-size: 1.5rem; font-weight: bold; color: var(--neon); }

        /* Liste de jeux (ton ancienne grille) */
        .grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 12px; padding: 12px; }
        .card { background: var(--card); border-radius: 12px; padding: 10px; text-align: center; border: 1px solid #333; }
        .not-owned { opacity: 0.25; filter: grayscale(100%); }
        .img-container { width: 100%; height: 150px; margin-bottom: 8px; }
        img { max-width: 100%; max-height: 100%; object-fit: contain; }
        .hidden { display: none; }
    </style>
</head>
<body>

    <div id="view-brands" class="view">
        <h1 style="text-align:center">Choisir une Marque</h1>
        <div class="menu-grid">
            <div class="menu-btn" onclick="showCategories('Nintendo')">üî¥ NINTENDO</div>
            <div class="menu-btn" onclick="showCategories('Playstation')">üîµ PLAYSTATION</div>
            <div class="menu-btn" onclick="showCategories('Xbox')">üü¢ XBOX</div>
        </div>
    </div>

    <div id="view-categories" class="view hidden">
        <h1 id="brand-title" style="text-align:center">Cat√©gories</h1>
        <div class="menu-grid">
            <div class="menu-btn" onclick="loadContent('Jeux')">üíø JEUX</div>
            <div class="menu-btn" onclick="loadContent('Consoles')">üéÆ CONSOLES</div>
            <div class="menu-btn" onclick="loadContent('Accessoires')">üîå ACCESSOIRES</div>
            <div class="menu-btn" style="background:#333" onclick="showView('view-brands')">‚¨ÖÔ∏è Retour</div>
        </div>
    </div>

    <div id="view-list" class="view hidden">
        <h1 id="list-title" style="text-align:center">Ma Collection</h1>
        <div id="app" class="grid"></div>
        <div style="text-align:center; padding: 20px;">
            <button class="menu-btn" onclick="showView('view-categories')">Retour aux cat√©gories</button>
        </div>
    </div>

    <div id="view-stats" class="view hidden">
        <h1 style="text-align:center">Mes Stats</h1>
        <div id="stats-content" class="stats-container">
            <div class="stat-card"><div>Valeur Totale Collection</div><div id="stat-total" class="stat-val">0 ‚Ç¨</div></div>
            <div class="stat-card"><div>Investissement total</div><div id="stat-invest" class="stat-val">0 ‚Ç¨</div></div>
            <div class="stat-card"><div>Jeux poss√©d√©s</div><div id="stat-count" class="stat-val">0 / 0</div></div>
        </div>
    </div>

    <nav class="bottom-nav">
        <div class="nav-item active" onclick="showView('view-brands')">üè†<br>Accueil</div>
        <div class="nav-item" onclick="showView('view-stats')">üìä<br>Stats</div>
    </nav>

    <script>
        const SHEET_ID = '1Vw439F_75oc7AcxkDriWi_fwX2oBbAejnp-f_Puw-FU';
        let currentBrand = '';
        let allData = { Jeux: [], Consoles: [], Accessoires: [] };

        function showView(viewId) {
            document.querySelectorAll('.view').forEach(v => v.classList.add('hidden'));
            document.getElementById(viewId).classList.remove('hidden');
            if(viewId === 'view-stats') calculateStats();
        }

        function showCategories(brand) {
            currentBrand = brand;
            document.getElementById('brand-title').innerText = brand.toUpperCase();
            showView('view-categories');
        }

        function getDirectImg(url) {
            if (!url || !url.includes('id=')) return url;
            const id = url.split('id=')[1].split('&')[0];
            return `https://drive.google.com/thumbnail?id=${id}&sz=w500`;
        }

        async function loadContent(category) {
            document.getElementById('list-title').innerText = currentBrand + " - " + category;
            showView('view-list');
            document.getElementById('app').innerHTML = "Chargement...";

            const url = `https://docs.google.com/spreadsheets/d/${SHEET_ID}/gviz/tq?tqx=out:json&sheet=${category}`;
            try {
                const response = await fetch(url);
                const text = await response.text();
                const json = JSON.parse(text.substr(47).slice(0, -2));
                const rows = json.table.rows;
                
                let html = '';
                rows.forEach(row => {
                    // Analyse par rapport √† ton tableau
                    const titre = row.c[0] ? row.c[0].v : 'Sans titre';
                    const marque = row.c[1] ? row.c[1].v : ''; // Colonne B pour la marque
                    const rawPhoto = row.c[6] ? row.c[6].v : '';
                    const cote = row.c[12] ? row.c[12].v : 0;
                    const possede = row.c[14] ? row.c[14].v : '';

                    // On filtre par marque s√©lectionn√©e
                    if (marque.toLowerCase().includes(currentBrand.toLowerCase())) {
                        const isOwned = (possede && possede.includes("Oui"));
                        html += `
                            <div class="card ${isOwned ? '' : 'not-owned'}">
                                <div class="img-container"><img src="${getDirectImg(rawPhoto)}"></div>
                                <div class="title">${titre}</div>
                                <div class="price">${cote} ‚Ç¨</div>
                            </div>
                        `;
                    }
                });
                document.getElementById('app').innerHTML = html || "Aucun article trouv√©.";
            } catch (e) {
                document.getElementById('app').innerHTML = "Erreur de chargement.";
            }
        }

        async function calculateStats() {
            // Ici on va charger l'onglet "Jeux" pour les stats (on pourra ajouter les autres apr√®s)
            const url = `https://docs.google.com/spreadsheets/d/${SHEET_ID}/gviz/tq?tqx=out:json&sheet=Jeux`;
            const response = await fetch(url);
            const text = await response.text();
            const json = JSON.parse(text.substr(47).slice(0, -2));
            const rows = json.table.rows;

            let totalCote = 0;
            let totalAchat = 0;
            let countOwned = 0;

            rows.forEach(row => {
                const cote = parseFloat(row.c[12]?.v) || 0;
                const achat = parseFloat(row.c[10]?.v) || 0; // Colonne K (Prix achat)
                const possede = row.c[14]?.v || '';

                totalCote += cote;
                totalAchat += achat;
                if(possede.includes("Oui")) countOwned++;
            });

            document.getElementById('stat-total').innerText = totalCote.toLocaleString() + " ‚Ç¨";
            document.getElementById('stat-invest').innerText = totalAchat.toLocaleString() + " ‚Ç¨";
            document.getElementById('stat-count').innerText = countOwned + " / " + rows.length;
        }

        // Au d√©marrage
        showView('view-brands');
    </script>
</body>
</html>
